{% extends "base.html" %}

{% block title %}{{ post.seo_title or post.title }}{% endblock %}
{% block description %}{{ post.seo_description or post.excerpt or 'Read more on the Ace Citizenship blog.' }}{% endblock %}

{# Open Graph overrides for articles #}
{% block og_type %}article{% endblock %}
{% block og_url %}https://acecitizenship.app/blog/{{ post.slug }}{% endblock %}
{% block og_title %}{{ post.seo_title or post.title }}{% endblock %}
{% block og_description %}{{ post.seo_description or post.excerpt or '' }}{% endblock %}
{% block og_image %}{% if post.featured_image %}{{ post.featured_image }}{% else %}https://acecitizenship.app/static/images/og-image.png{% endif %}{% endblock %}

{# Twitter Card overrides #}
{% block twitter_url %}https://acecitizenship.app/blog/{{ post.slug }}{% endblock %}
{% block twitter_title %}{{ post.seo_title or post.title }}{% endblock %}
{% block twitter_description %}{{ post.seo_description or post.excerpt or '' }}{% endblock %}
{% block twitter_image %}{% if post.featured_image %}{{ post.featured_image }}{% else %}https://acecitizenship.app/static/images/og-image.png{% endif %}{% endblock %}

{# Canonical URL #}
{% block canonical %}https://acecitizenship.app/blog/{{ post.slug }}{% endblock %}

{% block head %}
<!-- Article Schema -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "{{ post.title }}",
    "description": "{{ post.seo_description or post.excerpt or '' }}",
    "author": {
        "@type": "Person",
        "name": "Blake Crosley"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Ace Citizenship",
        "url": "https://acecitizenship.app"
    },
    "datePublished": "{{ post.published_at.isoformat() if post.published_at else '' }}",
    "dateModified": "{{ post.updated_at.isoformat() if post.updated_at else '' }}",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://acecitizenship.app/blog/{{ post.slug }}"
    }
    {% if post.featured_image %}
    ,"image": "{{ post.featured_image }}"
    {% endif %}
}
</script>
<!-- Breadcrumb Schema -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://acecitizenship.app"
        },
        {
            "@type": "ListItem",
            "position": 2,
            "name": "Blog",
            "item": "https://acecitizenship.app/blog"
        },
        {
            "@type": "ListItem",
            "position": 3,
            "name": "{{ post.title }}",
            "item": "https://acecitizenship.app/blog/{{ post.slug }}"
        }
    ]
}
</script>
{% if faq_items %}
<!-- FAQ Schema for Q&A content -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
        {% for item in faq_items %}
        {
            "@type": "Question",
            "name": "{{ item.question | e }}",
            "acceptedAnswer": {
                "@type": "Answer",
                "text": "{{ item.answer | e }}"
            }
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>
{% endif %}
{% endblock %}

{% block content %}
<article class="blog-post py-5">
    <div class="container">
        <header class="post-header mb-4">
            <a href="/blog" class="back-link text-decoration-none text-muted mb-3 d-inline-block">&larr; Back to Blog</a>
            <h1 class="display-5 fw-bold mb-3">{{ post.title }}</h1>
            <div class="post-meta text-muted">
                <span class="post-author">Blake Crosley</span>
                <span class="mx-2">&middot;</span>
                <time datetime="{{ post.published_at.isoformat() if post.published_at else '' }}">
                    {{ post.published_at.strftime('%B %d, %Y') if post.published_at else 'Draft' }}
                </time>
                <span class="mx-2">&middot;</span>
                <span class="reading-time">{{ post.reading_time }} min read</span>
            </div>
        </header>

        {% if post.featured_image %}
        <figure class="post-featured-image mb-4">
            <img src="{{ post.featured_image }}" alt="{{ post.title }}" class="img-fluid rounded" loading="lazy">
        </figure>
        {% endif %}

        <div class="post-body prose">
            {{ post.content_html | safe }}
        </div>

        <div class="share-section my-5 py-4 border-top border-bottom" x-data="{ copied: false }">
            <span class="share-label text-muted me-3">Share this article:</span>
            <div class="share-buttons d-inline-flex gap-2">
                <a
                    href="https://twitter.com/intent/tweet?text={{ post.title | urlencode }}&url=https://acecitizenship.app/blog/{{ post.slug }}"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="btn btn-sm btn-outline-secondary"
                    title="Share on X"
                >
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                </a>
                <a
                    href="https://www.linkedin.com/sharing/share-offsite/?url=https://acecitizenship.app/blog/{{ post.slug }}"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="btn btn-sm btn-outline-secondary"
                    title="Share on LinkedIn"
                >
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                </a>
                <button
                    class="btn btn-sm btn-outline-secondary"
                    title="Copy link"
                    @click="navigator.clipboard.writeText('https://acecitizenship.app/blog/{{ post.slug }}'); copied = true; setTimeout(() => copied = false, 2000)"
                >
                    <svg x-show="!copied" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    <svg x-show="copied" x-cloak width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                </button>
            </div>
        </div>

        {% if related_posts %}
        <aside class="related-posts mt-5">
            <h2 class="h4 mb-4">Keep Reading</h2>
            <div class="row g-3">
                {% for related in related_posts %}
                <div class="col-md-4">
                    <a href="/blog/{{ related.slug }}" class="related-post-card card h-100 text-decoration-none">
                        <div class="card-body">
                            <h3 class="h6 card-title">{{ related.title }}</h3>
                            <span class="small text-muted">{{ related.reading_time }} min read</span>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </aside>
        {% endif %}

        <footer class="post-footer mt-5">
            <a href="/blog" class="back-link text-decoration-none text-muted">&larr; Back to Blog</a>
        </footer>
    </div>
</article>

<!-- Back to Top Button -->
<button
    x-data="{ show: false }"
    x-init="window.addEventListener('scroll', () => { show = window.scrollY > 400 })"
    x-show="show"
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    @click="window.scrollTo({ top: 0, behavior: 'smooth' })"
    class="back-to-top btn btn-primary rounded-circle position-fixed"
    style="bottom: 2rem; right: 2rem; width: 48px; height: 48px;"
    aria-label="Back to top"
>
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
</button>
{% endblock %}
